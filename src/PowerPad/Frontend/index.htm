<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=no, maximum-scale=1.0" />
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<title>PowerPad</title>
		<script src="jquery-2.0.3.min.js"></script>
		<style>
			* {
				padding: 0;
				margin: 0;
				font-family: Verdana;
				box-sizing: border-box;
			}

			html, body {
				width: 100%;
				height: 100%;
				overflow: hidden;
			}

			#nextSlideImg {
				/* This stretches the image to fit, but we'll accept it for simplicity */
				width: 100%;
				height: 100%;
			}

			#status {
				position: absolute;
				width: 300px;
				top: 20px;
				left: 50%;
				margin-left: -150px;
				padding: 7px;	  
				border-radius: 5px;
				box-shadow: 2px 2px 7px #444;
				font-weight: bold;
				display: none;
			}

			#status.error {
				border: 1px solid #F00;
				background-color: #FCC;
			}

			#status.information {
				border: 1px solid #FF0;
				background-color: #FFC;
			}

			#progressBar {
				position: absolute;
				left: 0;
				top: 0;
				width: 100%;
				height: 15px;
				/*display: none;*/
			}
		</style>
	
		<script>
			var currentSlideNumberOnDisplay = null;

			$(function () {
				// Update the display once a second
				setInterval(function () {
					$.ajax({
						url: '/slideshowdata/',
						timeout: 2000,
						success: processData,
						error: processFailure
					});
				}, 1000);
			});

			var ProgressBar = new function () {
				return {
					setProgress: function (progress) {
						var $bar = $('#progressBar');
						var color = 'rgb(0,255,0)';
						
						// 00-49%:  Green
						// 50-64%:  Yellow
						// 65-74%:	Orange
						// 75-100%: Red
						if (progress >= 75)
							color = 'rgb(255, 0, 0)';
						else if (progress >= 65)
							color = 'rgb(255, 165, 0)';
						else if (progress >= 50)
							color = 'rgb(255, 255, 0)';

						$bar.css('background-image', '-webkit-linear-gradient(left, ' + color + ' 0%, ' + color + ' ' + progress + '%, rgba(127,127,127,0.2) ' + progress + '%)');
						$bar.show();
					}
				};
			}();
			
			function setStatus (status) {
				var $status = $('#status');

				$status.removeClass();
				$status.addClass('information');
				$status.html(status);
				$status.fadeIn();
			}
			
			function setErrorStatus (status) {
				var $status = $('#status');

				$status.removeClass();
				$status.addClass('error');
				$status.html(status);
				$status.fadeIn();
			}
			
			function clearStatus () {
				$('#status').fadeOut();
			}

			function processFailure(jqXHR) {
				console.log(jqXHR.status + ' ' + jqXHR.responseText);
				
				switch (jqXHR.status) {
					case 404:
						switch (jqXHR.responseText) {
							case 'No active slide show':
								setStatus('Slide show not running...');
								return;
								
							case undefined:
								setErrorStatus('Lost connection to PowerPad server');
								return;
						}
						return;
						
					case 0:
						setErrorStatus('Lost connection to PowerPad server');
						return;
				}
				
				setErrorStatus('Unexpected error (' + jqXHR.status + '): ' + jqXHR.responseText);
			}
			
			function processData (data) {
				clearStatus();

				// Update the slide image, but only if slide has changed
				if (currentSlideNumberOnDisplay != data.currentSlideNumber) {
					$('#nextSlideImg').attr('src', '/slideimage/?Number=' + (data.currentSlideNumber + 1));
					currentSlideNumberOnDisplay = data.currentSlideNumber;
				}
			}
		</script>
	</head>
	<body>			   
		<img id="nextSlideImg" />
		<div id="status"></div>
		<div id="progressBar"></div>
	</body>
</html>